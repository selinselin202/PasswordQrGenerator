<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password ‚Üí QR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5" style="max-width: 700px;">
    <h3>üîê Password ‚Üí QR Generator</h3>
    <p class="text-muted">Passwords are not stored on the server.</p>

    <div id="rowList"></div>

    <div class="mt-3 d-flex gap-2">
        <button class="btn btn-outline-secondary" onclick="addRow()">+ Add Row</button>
        <button class="btn btn-primary" onclick="generateQr()">Generate QR</button>
    </div>

    <div id="results" class="mt-5 d-flex flex-wrap gap-4"></div>
</div>

<script>
    addRow();

    function addRow() {
        var rowList = document.getElementById("rowList");

        var row = document.createElement("div");
        row.className = "d-flex gap-2 mb-2";
        row.innerHTML = `
            <input type="text" class="form-control" placeholder="Label (Gmail, Github...)" />
            <input type="password" class="form-control" placeholder="Password" />
            <button class="btn btn-outline-danger" onclick="removeRow(this)">Remove</button>
        `;

        rowList.appendChild(row);
    }

    function removeRow(button) {
        var row = button.parentElement;
        row.remove();
    }

    async function generateQr() {
        var rows = document.querySelectorAll("#rowList .d-flex");
        var entries = [];

        for (var i = 0; i < rows.length; i++) {
            var inputs = rows[i].querySelectorAll("input");
            var label = inputs[0].value.trim();
            var password = inputs[1].value.trim();

            if (password === "") continue;

            entries.push({ label: label, password: password });
        }

        if (entries.length === 0) {
            alert("Please enter at least one password.");
            return;
        }

        var response = await fetch("/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(entries)
        });

        var results = await response.json();

        var resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";

        for (var i = 0; i < results.length; i++) {
            var result = results[i];

            var card = document.createElement("div");
            card.className = "card p-3 text-center";
            card.style.width = "200px";
            card.innerHTML = `
                <img src="data:image/png;base64,${result.base64Image}" style="width:170px; height:170px;" />
                <div class="fw-bold mt-2">${result.label || "Password"}</div>
                <a href="data:image/png;base64,${result.base64Image}" 
                   download="${result.label || "qr"}.png" 
                   class="btn btn-sm btn-outline-primary mt-2">Download</a>
            `;

            resultsDiv.appendChild(card);
        }
    }
</script>

</body>
</html>